{% extends "base.html" %}
{% load i18n static wger_extras thumbnail django_bootstrap_breadcrumbs activity_tags %}

{#             #}
{# Breadcrumbs #}
{#             #}
{% block breadcrumbs %}
    {{ block.super }}

    {% breadcrumb "Groups" "groups:group:list" %}
    {% breadcrumb object object.get_absolute_url %}
{% endblock %}


{#       #}
{# Title #}
{#       #}
{% block title %}{{ object }}{% endblock %}



{#         #}
{# Content #}
{#         #}
{% block content %}

{# Render the activity stream #}
{% for event in last_activity %}
<div class="card">
    <div class="card-body">
        <p class="list-group-item-text float-right">

        {# Time #}
        {{ event.timestamp|timesince }}

            {# Verb #}
        {% if event.verb == 'added' %}
            <span class="{% fa_class 'plus' %}"></span>
        {% elif event.verb == 'created' %}
            <span class="{% fa_class 'asterisk' %}"></span>
        {% elif event.verb == 'edited' %}
            <span class="{% fa_class 'pencil-alt' %}"></span>
        {% elif event.verb == 'left' %}
            <span class="{% fa_class 'sign-out-alt' %}"></span>
        {% elif event.verb == 'joined' %}
            <span class="{% fa_class 'sign-in-alt' %}"></span>
        {% elif event.verb == 'promoted' %}
            <span class="{% fa_class 'asterisk' %}"></span>
        {% endif %}
        </p>

        {# Actor #}
        <p>
            {{ event.actor|format_username }}
        </p>

        {# Action object #}
        {% if event.action_object %}
        <p>
            {% if event.action_object.get_absolute_url %}
                <a href="{{ event.action_object.get_absolute_url }}">{{ event.action_object }}</a>
            {% else %}
                {{ event.action_object }}
            {% endif %}
        </p>
        {% endif %}
    </div>

</div>
{% endfor %}
{% endblock %}



{#         #}
{# Sidebar #}
{#         #}
{% block sidebar %}

    {% if object.image %}
        <img src="{{ object.image|thumbnail_url:'large' }}" class="img-fluid rounded">
        <br>
    {% endif %}

    {% if object.description %}
        <p style="white-space: pre-line;">{{ object.description }}</p>
    {% endif %}



    <h4 class="pt-3">{% trans "Members" %}</h4>
    <ul class="list-group">
    {% for membership in memberships_list %}
    <li class="list-group-item ">

        {{ membership.user|format_username }}
        {% if membership.is_admin %}
            <span class="badge badge-pill badge-primary">{% trans "Admin" %}</span>
        {% endif %}

        {% if membership.dropdowns %}
        <div class="dropdown float-right">
            <button class="btn btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            </button>
            <div class="dropdown-menu dropdown-menu-right">
                {% for option in membership.dropdowns %}
                    <a href="{{ option.1 }}" class="dropdown-item">{{ option.0 }}</a>
                {% endfor %}
            </div>
        </div>


        {% endif %}
    </li>
    {% empty %}
        <li class="list-group-item">
            {% trans "Nothing found" %}
        </li>
    {% endfor %}
    </ul>

    {% if user in object.get_admins_list and object.application_set.count %}
        <h4  class="pt-3">{% trans "Applicants" %}</h4>
        <ul class="list-group">
            {% for application in object.application_set.all %}
            <li class="list-group-item ">
                {{ application.user|format_username }}

                <div class="dropdown float-right">
                    <button class="btn btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    </button>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a href="{% url 'groups:application:accept' object.pk application.user.pk %}" class="dropdown-item">
                            <span class="{% fa_class 'ok' %}"></span>
                            {% trans "Accept" %}
                        </a>
                        <a href="{% url 'groups:application:deny' object.pk application.user.pk %}" class="dropdown-item">
                            <span class="{% fa_class 'remove' %}"></span>
                            {% trans "Deny" %}
                        </a>
                    </div>
                </div>


            </li>
            {% endfor %}
        </ul>
    {% endif %}


    <h4  class="pt-3">{% trans "Workouts" %}</h4>
    <div class="list-group">
        {% for workout in object.workout_set.all %}
            <a class="list-group-item" href="{{ workout.get_absolute_url }}">
                {{ workout }}
            </a>
        {% empty %}
            <div class="list-group-item">{% trans "Nothing found" %}</div>
        {% endfor %}
    </div>
    <a href="{% url 'manager:workout:add' object.pk %}" class="btn btn-block btn-block">{% trans 'Add workout' %}</a>

{% endblock %}


{% block options %}
{% if group_dropdown %}
    <div class="dropdown">
        <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="{% fa_class 'cog' %}"></span>
            {% trans "Options" %}
        </button>
        <div class="dropdown-menu">
            {% for entry in group_dropdown %}
            <a href="{{ entry.1 }}" class="dropdown-item">{{ entry.0 }}</a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
{% endblock %}
